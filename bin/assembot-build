#!/usr/bin/env coffee

cli= require 'commander'
pkg= require '../package'
{assembot, _, loadTargets}= require '../lib/assembot'
log= require '../lib/assembot/log'

cli
  .version(pkg.version)
  .option('-v, --verbose', 'force installation')
  .option('-q, --quiet', 'force installation')
  .parse(process.argv);

log.level 0 if cli.quiet
log.level 2 if cli.verbose

log.info ''
log.info "Building..."

targets = []

targets.push {target, options} for target, options of loadTargets()

buildIt= ->
  if targets.length is 0
    log.info "Done"
  else
    {target, options}= targets.shift()
    log.debug "Target:", target
    log.debug "Configuration:"
    log.debug options
    bot= assembot target, options
    bot.build().then buildIt

buildIt()
