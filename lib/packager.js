// Generated by CoffeeScript 1.5.0
(function() {
  var addPackager, build, ecss_wrapper, packagers;

  build = function(target, resources, options, done) {
    var packager;
    packager = packagers[target];
    if (packager == null) {
      return done(new Error("Unknown package target '" + target + "'"));
    }
    return packager(resources, options, done);
  };

  packagers = {};

  addPackager = function(target, packager) {
    return packagers[target] = packager;
  };

  module.exports = {
    build: build,
    addPackager: addPackager
  };

  addPackager('css', function(resources, options, done) {
    var res, results, _i, _len;
    results = "";
    for (_i = 0, _len = resources.length; _i < _len; _i++) {
      res = resources[_i];
      results += "/* " + res.path + " */\n";
      results += res.content;
      results += "\n\n";
    }
    return done(null, results);
  });

  ecss_wrapper = function(css) {
    return "var node = null, css = " + (JSON.stringify(css)) + ";\nmodule.exports= {\n  content: css,\n  isActive: function(){ return node != null; },\n  activate: function(to){\n    if(node != null) return; // Already added to DOM!\n    to= to || document.getElementsByTagName('HEAD')[0] || document.body || document; // In the HEAD or BODY tags\n    node= document.createElement('style');\n    node.innerHTML= css;\n    to.appendChild(node);\n    return this;\n  },\n  deactivate: function() {\n    if(node != null) {\n      node.parentNode.removeChild(node);\n      node = null;\n    }\n    return this;\n  }\n};";
  };

  module.exports.embedded_css = ecss_wrapper;

  addPackager('js', function(resources, options, callback) {
    var autoStart, i, identifier, res, result, _i, _len, _ref, _ref1, _ref2;
    identifier = (_ref = options.ident) != null ? _ref : 'require';
    autoStart = (_ref1 = (_ref2 = options.autoStart) != null ? _ref2 : options.autoLoad) != null ? _ref1 : false;
    result = "(function(/*! Stitched by Assembot !*/) {\n  /* \n    The commonjs code below was based on @sstephenson's stitch.\n    https://github.com/sstephenson/stitch\n  */\n  if (!this." + identifier + ") {\n    var modules = {}, cache = {}, moduleList= function(startingWith) {\n      var names= [], startingWith= startingWith || '';\n      for( var name in modules ) {\n        if(name.indexOf(startingWith) === 0) names.push(name);\n      }\n      return names;\n    }, require = function(name, root) {\n      var path = expand(root, name), module = cache[path], fn;\n      if (module) {\n        return module.exports;\n      } else if (fn = modules[path] || modules[path = expand(path, './index')]) {\n        module = {id: path, exports: {}};\n        try {\n          cache[path] = module;\n          var localRequire= function(name) {\n            return require(name, dirname(path));\n          }\n          localRequire.modules= moduleList;\n          fn(module.exports, localRequire, module);\n          return module.exports;\n        } catch (err) {\n          delete cache[path];\n          throw err;\n        }\n      } else {\n        throw 'module \\'' + name + '\\' not found';\n      }\n    }, expand = function(root, name) {\n      var results = [], parts, part;\n      if (/^\\.\\.?(\\/|$)/.test(name)) {\n        parts = [root, name].join('/').split('/');\n      } else {\n        parts = name.split('/');\n      }\n      for (var i = 0, length = parts.length; i < length; i++) {\n        part = parts[i];\n        if (part == '..') {\n          results.pop();\n        } else if (part != '.' && part != '') {\n          results.push(part);\n        }\n      }\n      return results.join('/');\n    }, dirname = function(path) {\n      return path.split('/').slice(0, -1).join('/');\n    };\n    this." + identifier + " = function(name) {\n      return require(name, '');\n    }\n    this." + identifier + ".define = function(bundle) {\n      for (var key in bundle)\n        modules[key] = bundle[key];\n    };\n    this." + identifier + ".modules= moduleList;\n  }\n  return this." + identifier + ".define;\n}).call(this)({\n";
    for (i = _i = 0, _len = resources.length; _i < _len; i = ++_i) {
      res = resources[i];
      result += i === 0 ? "" : ",\n";
      result += JSON.stringify(res.path);
      result += ": function(exports, require, module) {\n" + res.content + "\n}";
    }
    result += "});\n";
    if (autoStart) {
      result += "" + identifier + "('" + autoStart + "');\n";
    }
    return callback(null, result);
  });

}).call(this);
